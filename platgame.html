<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic Platformer with Boss</title>
    <style>
        body { margin: 0; background: #06060a; color: white; font-family: monospace; }
        canvas { background: #111; display: block; margin: auto; border: 3px solid #888; box-shadow: 0 0 20px #0ff; }
        #endScreen {
            display:none;
            position:absolute;
            top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.95);
            color:white; text-align:center;
            font-family: monospace;
            padding-top:150px;
            font-size:24px;
        }
        #endScreen a {
            color:#0ff;
            font-size:28px;
            text-decoration:none;
            display:block;
            margin-top:30px;
        }
    </style>
</head>
<body>
<canvas id="game" width="800" height="450"></canvas>
<div id="endScreen">
    ðŸŽ‰ YOU BEAT THE BOSS!<br>
    Total Coins: <span id="finalScore">0</span><br>
    <a href="https://thenull.vercel.app" target="_blank">Return to Null Home</a>
</div>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const endScreen = document.getElementById("endScreen");
const finalScore = document.getElementById("finalScore");

let level = 1;
let bossHp = 30;
let score = 0;
let gameEnded = false;

const player = { x:50, y:350, w:30, h:30, dx:0, dy:0, speed:4, jumping:false };
let platforms = [], coins = [], enemies = [];

function loadLevel(n){
    const levelData = [
        { platforms:[{x:0,y:420,w:800,h:30},{x:200,y:350,w:120,h:20},{x:380,y:300,w:120,h:20},{x:560,y:250,w:120,h:20}],
          coins:[{x:230,y:320},{x:410,y:270},{x:590,y:220}],
          enemies:[{x:300,y:390,w:30,h:30,dir:1},{x:500,y:390,w:30,h:30,dir:-1}], boss:false },

        { platforms:[{x:0,y:420,w:800,h:30},{x:150,y:330,w:150,h:20},{x:370,y:280,w:150,h:20},{x:600,y:230,w:150,h:20}],
          coins:[{x:180,y:300},{x:400,y:250},{x:630,y:200}],
          enemies:[{x:200,y:390,w:30,h:30,dir:1},{x:450,y:390,w:30,h:30,dir:-1},{x:650,y:390,w:30,h:30,dir:1}], boss:false },

        { platforms:[{x:0,y:420,w:800,h:30},{x:120,y:360,w:100,h:20},{x:270,y:310,w:100,h:20},{x:420,y:260,w:100,h:20},{x:570,y:210,w:100,h:20}],
          coins:[{x:150,y:330},{x:300,y:280},{x:450,y:230},{x:600,y:180}],
          enemies:[{x:250,y:390,w:30,h:30,dir:1},{x:500,y:390,w:30,h:30,dir:-1}], boss:false },

        { platforms:[{x:0,y:420,w:800,h:30}], coins:[], enemies:[], boss:true }
    ];

    const d = levelData[n-1];
    platforms = d.platforms;
    coins = d.coins.map(c=>({...c,taken:false}));
    enemies = d.enemies;
    player.x = 50; player.y = 350; player.dy = 0; player.jumping = false;
    window.boss = d.boss ? {x:350,y:350,w:100,h:50,dir:2} : null;
}

loadLevel(level);

// Controls
const keys = {};
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

function update(){
    if(keys["a"]) player.dx = -player.speed;
    else if(keys["d"]) player.dx = player.speed;
    else player.dx = 0;

    if(keys["w"] && !player.jumping){ player.dy = -10; player.jumping = true; }

    player.dy += 0.5;
    player.x += player.dx;
    player.y += player.dy;

    // Platform collision
    platforms.forEach(p=>{
        if(player.x < p.x+p.w && player.x+player.w > p.x && player.y < p.y+p.h && player.y+player.h > p.y){
            player.y = p.y - player.h; player.dy = 0; player.jumping = false;
        }
    });

    // Coins
    coins.forEach(c=>{
        if(!c.taken && Math.abs(player.x-c.x)<25 && Math.abs(player.y-c.y)<25){ c.taken=true; score++; }
    });

    // Boss logic
    if(window.boss){
        window.boss.x += window.boss.dir;
        if(window.boss.x < 100 || window.boss.x > 600) window.boss.dir*=-1;

        // Player stomps boss
        if(player.x < window.boss.x+window.boss.w && player.x+player.w > window.boss.x && player.y+player.h < window.boss.y+10 && player.y+player.h > window.boss.y-10){
            bossHp--;
            player.dy = -8;
            if(bossHp <=0){ gameEnded = true; }
        }

        // Player hits boss body
        if(player.x < window.boss.x+window.boss.w && player.x+player.w > window.boss.x && player.y < window.boss.y+window.boss.h && player.y+player.h > window.boss.y){
            alert("â˜  Smashed by the Boss! Score: "+score);
            score=0; level=1; bossHp=30; loadLevel(level);
        }
    }

    // Level complete (before boss)
    if(!window.boss && player.x > 800){
        level++;
        loadLevel(level);
    }

    // Game end
    if(gameEnded){
        finalScore.innerText = score;
        endScreen.style.display = "block";
    }
}

function draw(){
    ctx.clearRect(0,0,800,450);

    // Platforms
    ctx.fillStyle="#0f0";
    platforms.forEach(p=>ctx.fillRect(p.x,p.y,p.w,p.h));

    // Player
    ctx.fillStyle="#0ff";
    ctx.fillRect(player.x,player.y,player.w,player.h);

    // Coins
    ctx.fillStyle="#ff0";
    coins.forEach(c=>{ if(!c.taken) ctx.fillRect(c.x,c.y,10,10); });

    // Boss
    if(window.boss){
        ctx.fillStyle="#f0f";
        ctx.fillRect(window.boss.x,window.boss.y,window.boss.w,window.boss.h);
        ctx.fillStyle="white";
        ctx.fillText("BOSS HP: "+bossHp, 650,20);
    }

    // HUD
    ctx.fillStyle="white";
    ctx.fillText("Level: "+level+"   Coins: "+score, 10, 20);
}

function loop(){ update(); draw(); if(!gameEnded) requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
